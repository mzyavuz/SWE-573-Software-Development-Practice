<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category ‚Äî The Commons ‚Äî Hive</title>
    <link rel="stylesheet" href="/static/css/navbar.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #f59e0b;
            --primary-dark: #d97706;
            --secondary-color: #10b981;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --bg-light: #f9fafb;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.15);
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: var(--bg-light);
        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .breadcrumb {
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            font-size: 0.9rem;
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-lg);
        }

        .category-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .actions-bar {
            background: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: flex-end;
        }

        .new-thread-btn {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .new-thread-btn:hover {
            background-color: var(--primary-dark);
        }

        .threads-section {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .thread-card {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .thread-card:last-child {
            border-bottom: none;
        }

        .thread-card:hover {
            background-color: var(--bg-light);
        }

        .thread-title {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .thread-meta {
            display: flex;
            gap: 1rem;
            color: var(--text-light);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .thread-stats {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        @media (max-width: 768px) {
            .thread-meta {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">
                <img src="/static/hive_logo.png" alt="Hive Logo">
                Hive
            </a>
            <div id="nav-buttons"></div>
        </div>
    </nav>

    <div class="main-container">
        <div class="breadcrumb">
            <a href="/forum">The Commons</a> ‚Ä∫ <span id="category-name-breadcrumb">...</span>
        </div>

        <div class="category-header">
            <h1 id="category-name">Loading...</h1>
            <p id="category-description"></p>
        </div>

        <div class="actions-bar">
            <a href="/forum/new-thread?category=" id="new-thread-link" class="new-thread-btn">+ New Thread</a>
        </div>

        <div class="threads-section">
            <div id="threads-list">
                <div class="loading">Loading threads...</div>
            </div>
        </div>
    </div>

    <script src="/static/js/navbar.js"></script>
    <script>
        // Extract category ID from URL path: /forum/category/1
        const pathParts = window.location.pathname.split('/');
        const categoryId = pathParts[pathParts.length - 1];

        async function loadCategory() {
            try {
                // Get category info
                const categoriesResponse = await fetch('/api/forum/categories');
                const categoriesData = await categoriesResponse.json();
                const category = categoriesData.categories.find(c => c.id == categoryId);

                if (!category) {
                    throw new Error('Category not found');
                }

                document.getElementById('category-name').textContent = category.name;
                document.getElementById('category-name-breadcrumb').textContent = category.name;
                document.getElementById('category-description').textContent = category.description || '';
                document.getElementById('new-thread-link').href = `/forum/new-thread?category=${categoryId}`;
                document.title = `${category.name} ‚Äî The Commons ‚Äî Hive`;

                // Get threads
                const threadsResponse = await fetch(`/api/forum/threads?category=${categoryId}`);
                const threadsData = await threadsResponse.json();
                const threads = threadsData.threads;

                if (threads.length === 0) {
                    document.getElementById('threads-list').innerHTML = `
                        <div class="loading">
                            <p>No threads yet. Be the first to start a discussion!</p>
                        </div>
                    `;
                    return;
                }

                const html = threads.map(thread => {
                    const createdDate = new Date(thread.created_at);
                    const timeAgo = getTimeAgo(createdDate);
                    const commentCount = thread.comment_count || 0;

                    return `
                        <a href="/forum/thread/${thread.id}" class="thread-card">
                            <div class="thread-title">
                                ${thread.is_pinned ? 'üìå ' : ''}
                                ${thread.is_locked ? 'üîí ' : ''}
                                ${thread.title}
                            </div>
                            <div class="thread-meta">
                                <span>By ${thread.first_name} ${thread.last_name}</span>
                                <span>‚Ä¢</span>
                                <span>${timeAgo}</span>
                            </div>
                            <div class="thread-stats">
                                <span>üëÅÔ∏è ${thread.view_count || 0} views</span>
                                <span>üí¨ ${commentCount} ${commentCount === 1 ? 'reply' : 'replies'}</span>
                            </div>
                        </a>
                    `;
                }).join('');

                document.getElementById('threads-list').innerHTML = html;

            } catch (error) {
                console.error('Error loading category:', error);
                document.getElementById('threads-list').innerHTML = `
                    <div class="loading">
                        <p>Unable to load category. <a href="/forum">Return to forum</a></p>
                    </div>
                `;
            }
        }

        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60
            };

            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval === 1 ? '' : 's'} ago`;
                }
            }

            return 'just now';
        }

        NavBar.init('forum').then(() => {
            loadCategory();
        }).catch(error => {
            console.error('Navigation initialization failed:', error);
            window.location.href = '/signin';
        });
    </script>
</body>
</html>
